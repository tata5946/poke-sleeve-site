<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒã‚±ã‚«ã‚¹ãƒªãƒ¼ãƒ–ä¾¡æ ¼æ¨ç§»</title>
  <meta name="description" content="ãƒã‚±ã‚«ã‚¹ãƒªãƒ¼ãƒ–ã®å¹´æ¬¡å¹³å‡ä¾¡æ ¼æ¨ç§»ã‚’æ²è¼‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ãƒˆã€‚å„ã‚¹ãƒªãƒ¼ãƒ–ã®ç›¸å ´å¤‰å‹•ã‚’ç¢ºèªã§ãã¾ã™ã€‚">
  <style>
    body { font-family: sans-serif; margin: 40px; }
    h1 { margin-bottom: 10px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 14px; padding:0; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; }
    .title { font-weight: 800; font-size: 16px; margin-bottom: 6px; }
    .meta { font-size: 13px; color: #666; }
    a.btn { display:inline-block; margin-top: 10px; text-decoration:none; border:1px solid #333; padding:8px 10px; border-radius:8px; color:#111; }
    .error { background:#fff3f3; border:1px solid #ffcccc; padding:12px; border-radius:10px; color:#b00020; margin: 12px 0; }
    .small { font-size: 12px; color:#666; }
  </style>
</head>
<body>
  <h1>ãƒã‚±ã‚«ã‚¹ãƒªãƒ¼ãƒ–ä¾¡æ ¼æ¨ç§»</h1>
  <p><a href="./ranking.html">ğŸ“ˆ ä¾¡æ ¼ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¦‹ã‚‹</a></p>
  <p><a href="./growth.html">ğŸ”¥ é«˜é¨°ç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¦‹ã‚‹</a></p>
<p>
å½“ã‚µã‚¤ãƒˆã¯ã€ãƒã‚±ã‚«ã‚¹ãƒªãƒ¼ãƒ–ã®å¹´æ¬¡å¹³å‡ä¾¡æ ¼æ¨ç§»ã‚’ã¾ã¨ã‚ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚
å„ã‚¹ãƒªãƒ¼ãƒ–ã”ã¨ã®ç›¸å ´å¤‰å‹•ã‚’ä¸€è¦§ã§ç¢ºèªã§ãã¾ã™ã€‚
</p>
  <input type="text" id="search" placeholder="ã‚¹ãƒªãƒ¼ãƒ–åã§æ¤œç´¢..." style="padding:8px; width:300px; margin-bottom:12px;">
  <p class="small">ãƒ‡ãƒ¼ã‚¿ï¼ˆdata.jsonï¼‰ã‚’æ›´æ–°ã™ã‚‹ã¨ä¸€è¦§ãŒè‡ªå‹•ã§å¢—ãˆã¾ã™ã€‚</p>

  <div id="error" class="error" style="display:none;"></div>
  <div id="list" class="grid"></div>

  <script>
    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function showError(msg) {
      const el = document.getElementById("error");
      el.style.display = "block";
      el.textContent = msg;
    }

    async function loadData() {
      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å½±éŸ¿ã§å¤ã„ data.json ã‚’æ´ã‚€ã“ã¨ãŒã‚ã‚‹ã®ã§ã€ã‚¯ã‚¨ãƒªã§å›é¿
      const res = await fetch("./data.json?v=" + Date.now(), { cache: "no-store" });
      if (!res.ok) {
        throw new Error(`data.json ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆHTTP ${res.status}ï¼‰`);
      }
      return await res.json();
    }

    async function main() {
      const list = document.getElementById("list");
      const searchInput = document.getElementById("search");

      let data;
      try {
        data = await loadData();
      } catch (e) {
        showError(e.message + " / ãƒ•ã‚¡ã‚¤ãƒ«åã‚„é…ç½®ï¼ˆãƒ«ãƒ¼ãƒˆç›´ä¸‹ã« data.jsonï¼‰ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      if (!data || !Array.isArray(data.sleeves)) {
        showError("data.json ã®å½¢å¼ãŒæƒ³å®šã¨é•ã„ã¾ã™ã€‚{ sleeves: [...] } ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      function render(keyword = "") {
        const kw = keyword.trim().toLowerCase();
        list.innerHTML = "";

        const filtered = data.sleeves.filter(s =>
          String(s.name || "").toLowerCase().includes(kw)
        );

        if (filtered.length === 0) {
          list.innerHTML = `<div class="card"><div class="title">è©²å½“ãªã—</div><div class="meta">æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ã‚¹ãƒªãƒ¼ãƒ–ãŒã‚ã‚Šã¾ã›ã‚“</div></div>`;
          return;
        }

        for (const s of filtered) {
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <div class="title">${escapeHtml(s.name ?? "")}</div>
            <div class="meta">ç™ºå£²å¹´ï¼š${escapeHtml(s.releaseYear ?? "")} / ${escapeHtml(s.condition ?? "")} / ${escapeHtml(s.series ?? "")}</div>
            <a class="btn" href="./detail.html?id=${encodeURIComponent(s.id ?? "")}">ä¾¡æ ¼æ¨ç§»ã‚’è¦‹ã‚‹ â†’</a>
          `;
          list.appendChild(div);
        }
      }

      // åˆæœŸè¡¨ç¤º
      render("");

      // æ¤œç´¢
      searchInput.addEventListener("input", () => render(searchInput.value));
    }

    main();
  </script>
</body>
</html>
